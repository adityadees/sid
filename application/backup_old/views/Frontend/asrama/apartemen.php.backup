<section id="page-title"  class="background-overlay-dark" data-parallax-image="<?= base_url('assets/images/asrama/apartemen.png')?>">
    <div class="container">
        <div class="page-title">
            <h1><?= $title; ?></h1>
        </div>
        <div class="breadcrumb">
            <ul>
                <li><a href="<?= base_url()?>" title="Home">Home</a></li>
                <li><a href="<?= base_url('asrama')?>" title="Asrama">Asrama</a></li>
                <li class="active"><a href="#"><?= $title; ?></a></li>
            </ul>
        </div>
    </div>
</section>

<section class="box-fancy section-fullwidth text-light p-b-0 p-t-0">
    <div class="row">
        <div class="col-lg-4" style="background-color: rgb(241, 183, 50);">
            <div class="row">
                <div class="col-md-12">
                    <h1 class="text-lg text-uppercase">01.</h1>
                    <h3>Select Type</h3>
                    <span>
                        Apartemen UNSRI memiliki 2 buah gedung yaitu <span class="badge badge-danger">Gedung A</span> dan <span class="badge badge-danger">Gedung B</span>, setiap gedung memiliki tinggi <span class="badge badge-danger">5 Lantai.</span>
                        Anda dapat melihat dan menentukan sendiri di gedung dan lantai berapakah anda ingin menyewanya.
                    </span>
                    <br>
                    <br>
                    <h3>Persyaratan</h3>
                    <ul class="list-icon list-icon-arrow list-icon-colored">
                        <li>Apartemen yang terdiri dari dua tower untuk putra dan putri setiap kamarnya disewakan kepada mahasiswa.</li>
                        <li>Setiap kamar diisi oleh dua orang mahasiswa</li>
                        <li>Biaya sewa apartemen setiap kamar sebesar Rp. 600.000 per kamar per dua orang mahasiswa per bulan atau biaya sewa per orang sebesar Rp. 300.000 per kamar per bulan.</li>
                        <li>Pembayaran sewa kamar apartemen dibayar dimuka selama satu tahun.</li>
                        <li>Mahasiswa baru bisa di daftarkan sebagai penyewa kamar apartemen apabila telah
                        menyerahkan bukti bayar sewa dari Bank Sumsel Babel kepada petugas dibagian kemahasiswaan BAAK Unsri.</li>
                    </ul>

                    <div class="line"></div>



                    <form>
                        <fieldset class="form-group">
                            <div class="row">
                                <legend class="col-form-label col-sm-2 pt-0">Gedung</legend>
                                <div class="col-sm-10">

                                    <div class="form-check">
                                        <label class="p-radio">
                                            <input type="radio" name="gdgtype" value="AA" checked>
                                            <span class="p-radio-style"></span>
                                            <span>&nbsp;Gedung A</span>
                                        </label>
                                    </div>


                                    <div class="form-check">
                                        <label class="p-radio">
                                            <input type="radio" name="gdgtype" value="AB">
                                            <span class="p-radio-style"></span>
                                            <span>&nbsp;Gedung B</span>
                                        </label>
                                    </div>

                                </div>
                            </div>
                        </fieldset>


                        <div id="newd">
                        </div>


                        <div class="form-group row">
                            <label for="inputPassword3" class="col-sm-2 col-form-label">Lantai</label>
                            <div class="col-sm-10">
                                <select id="lantaiid" class="form-control">
                                    <option value="1">Lantai 1</option>
                                    <option value="2">Lantai 2</option>
                                    <option value="3">Lantai 3</option>
                                    <option value="4">Lantai 4</option>
                                    <option value="5">Lantai 5</option>
                                </select>

                            </div>
                        </div>
                        <input type="hidden" name="" id="readLantai">
                        <input type="hidden" name="" id="readGedung">
                        <div class="form-group row">
                            <div class="col-sm-10">
                                <button type="button" class="btn" id="btn_update">Cek</button>
                            </div>
                        </div>
                    </form>


                </div>
            </div>
        </div>
        <div class="col-lg-8" style="background-color: rgb(252, 196, 63);">
            <div class="row">
                <div class="col-md-12">
                    <h2 class="text-lg text-uppercase">02.</h2>
                    <h3>Select Room</h3>
                    <span>
                        Gambar dibawah ini merupakan denah lokasi apartemen, untuk melakukan pengajuan permohonan penyewaan apartemen sialahkan arahkan mouse pada kotak kemudian klik maka secara otomatis akan muncul popup yang berisikan aggrement box.
                    </span>

                    <br>
                    <br>
                    <h3>Informasi</h3>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="p-progress-bar-container radius small title-up">
                                <div class="p-progress-bar" data-percent="<?= $box['tersedia'];?>" data-delay="100" data-type="%" id="progtersedia">
                                    <div class="progress-title">Kosong</div>
                                </div>
                            </div>
                            <div class="p-progress-bar-container radius small title-up">
                                <div class="p-progress-bar" data-percent="<?= $box['terisi'];?>" data-delay="300" data-type="%" id="progterisi">
                                    <div class="progress-title">Terisi</div>
                                </div>
                            </div>
                        </div>


                        <div class="col-md-6">
                            <div class="p-progress-bar-container radius small title-up">
                                <div class="p-progress-bar" data-percent="<?= $box['booking'];?>" data-delay="200" data-type="%" id="progbooking">
                                    <div class="progress-title">Booking</div>
                                </div>
                            </div>
                            <div class="p-progress-bar-container radius small title-up">
                                <div class="p-progress-bar" data-percent="<?= $box['rusak'];?>" data-delay="400" data-type="%" id="progrusak">
                                    <div class="progress-title">Rusak</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="line"></div>

            <div class="portfolio-item-wrap">
                <object data="<?= base_url('assets/svgrender/apartemen.svg')?>" type="image/svg+xml" id="alphasvg" width="100%" height="100%"></object>
            </div>


        </div>
    </div>
</section>


<div class="modal fade" id="myModal" tabindex="-1" role="modal" aria-labelledby="modal-label" aria-hidden="true" style="display: none;">
    <div class="modal-dialog modal-lg">
        <form action="<?= base_url('frontend/asrama/booking_kamar')?>" method="POST" enctype="multipart/form-data">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="modal-label"></h4>
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-12">

                            <div class="row" id="myDIV">

                                <div class="col-lg-12">
                                    <div class="card">
                                        <div class="card-body" style="overflow: scroll;overflow-x: hidden;max-height: 200px">
                                            <div class="row">
                                                <div class="col-md-12">

                                                    <h4 class="text-center">Terms & Agreement </h4>
                                                    <p class="text-justify">
                                                        <small>
                                                            Dengan ini saya akan menyetujia dan mematuhi semua perjanjian dan peraturan yang tertulis dalam point dibawah ini :
                                                        </small>
                                                    </p>

                                                    <ul class="list-icon list-icon-uncheck list-icon-colored">
                                                        <li>PENYEWA berhak atas pemakaian aliran listrik, saluran nomor telepon, dan air PDAM yang telah terpasang sebelumnya pada bangunan rumah yang disewa.</li>
                                                        <li>Segala kerugian yang timbul akibat kelalaian PENYEWA dalam memenuhi kewajibannya sepenuhnya menjadi tanggung jawab PENYEWA.</li>
                                                        <li>PENYEWA berkewajiban merawat dan menjaga keadaan tersebut agar tetap dalam kondisi baik termasuk memelihara kebersihan dan kelestarian lingkungan termasuk memelihara kebersihan dan kelestarian lingkungan serta sarana-sarana kepentingan umum.</li>
                                                    </ul>

                                                </div>
                                            </div>
                                        </div>
                                        <div class="card-footer text-muted">
                                            <div class="row">
                                                <div class="col-md-11">
                                                    <input type="checkbox" name="checkb" class="agreecbox"> 
                                                    <span id="agreebox">
                                                        Saya memahami dan menyetujui semua persyaratan diatas.
                                                    </span>
                                                </div>
                                                <div class="col-md-1" id="infoAlert" style="display: none">
                                                    <i class="fa fa-info text-right text-danger" title="Anda harus menyetujuinya"></i>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row" id="nextDiv" style="display: none">
                                <div class="col-lg-12">
                                    <div class="card">
                                        <div class="card-body">
                                            <div class="row">
                                                <div class="col-md-12">
                                                    <h4 class="text-center">Informasi </h4>
                                                    <br>
                                                    <div class="form-group row">
                                                        <label for="inputEmail3" class="col-sm-3 col-form-label">Jenis</label>
                                                        <div class="col-sm-9">
                                                            Apartemen Gedung <span id="dgedung"></span>
                                                        </div>
                                                    </div>

                                                    <div class="form-group row">
                                                        <label for="inputEmail3" class="col-sm-3 col-form-label">Lantai</label>
                                                        <div class="col-sm-9">
                                                            <span id="dlantai"></span>
                                                        </div>
                                                    </div>
                                                    <div class="form-group row">
                                                        <label for="inputEmail3" class="col-sm-3 col-form-label">Nomor Kamar</label>
                                                        <div class="col-sm-9">
                                                            <span id="dnkamar"></span>
                                                        </div>
                                                    </div>
                                                    <div class="form-group row">
                                                        <label for="inputEmail3" class="col-sm-3 col-form-label">Upload Bukti SPP Terakhir</label>
                                                        <div class="col-sm-9">
                                                            <input type="file" name="filefoto" required="">
                                                        </div>
                                                    </div>

                                                    <input type="hidden" name="ids" id="id"/>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-b" style="display: none" id="btnBack">Back</button>
                    <button type="button" class="btn btn-b" id="btnNext">Next</button>
                    <button type="submit" class="btn btn-b" style="display: none" id="btnFinish">Finish</button>
                </div>
            </div>
        </form>
    </div>
</div>



<script type="text/javascript" src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
<script type="text/javascript">
    let dataArr = <?= $ar; ?>;
    let gid; 
    var mySVG = document.getElementById("alphasvg");
    var svgDoc;
    mySVG.addEventListener("load",function() {

        svgDoc = mySVG.contentDocument.documentElement;

        var xd = svgDoc.getElementsByTagName("rect");
        var xy = svgDoc.getElementsByTagName("tspan");
        var lantai = xy[31];
        var tipe = xy[32];

        $('#btn_update').on('click',function(){
            resetState(xd, dataArr, 'reset');
            var gdgtyp = $("input[name='gdgtype']:checked").val();
            var lantaiid=$('#lantaiid').val();
            $.ajax({
                type: "POST",
                url: "<?= base_url('ajxsrama');?>",
                data: { gdgtyp: gdgtyp, lantaiid: lantaiid}, 
                cache: false,
                success: function(result) {
                    lantai.textContent = JSON.parse(result).lantaix;
                    tipe.textContent = JSON.parse(result).tipex;
                    dataArr = JSON.parse(result).alldata;

                    bar_prog('#progtersedia',JSON.parse(result).tersedia);
                    bar_prog('#progbooking',JSON.parse(result).booking);
                    bar_prog('#progrusak',JSON.parse(result).rusak);
                    bar_prog('#progterisi',JSON.parse(result).terisi);

                    resetState(xd, dataArr, 'success_call');
                }
            });
        });
        resetState(xd, dataArr, 'inisiasi');

    }, false);

    function bar_prog(name, val){
        console.log($(name +' .progress-number').text(val));
        $(name).data('data-percent',val);
        $(name).attr('style','width : ' + val+'%');  
    }

    function resetState(p_arg1, p_arg2, type){
        xd = p_arg1;
        dataArr = p_arg2;
        for(i=0;i<xd.length;i++){
            let get_a = xd[i].getAttribute('id');
            let gid; 
            let glantai; 
            let gstatus_asrama; 
            let gstatus_kamar; 
            let gidval; 
            let jgedung; 
            let jnkmar; 

            for (var a = 0; a < dataArr.length; a++) {
                if (dataArr[a].idval == get_a) {
                    gid = dataArr[a].id;
                    jgedung = gid.substring(1, 2);
                    jnkmar = gid.substring(3, 5);

                    glantai = dataArr[a].lantai;
                    gidval = dataArr[a].idval;
                    gstatus_asrama = dataArr[a].status_asrama;
                    gstatus_kamar = dataArr[a].status_kamar;
                    if(type == 'reset'){
                        xd[i].style.fill="#ffffff";
                        break;
                    } else {
                        if(dataArr[a].status_asrama=='rusak'){
                            xd[i].style.fill="#4e4e4e";
                        } else {
                            if(dataArr[a].status_kamar=='booking'){
                                xd[i].style.fill="#50878e";
                            } else if(dataArr[a].status_kamar=='isi'){
                                xd[i].style.fill="#d04c47";

                            }else if(dataArr[a].status_kamar=='perbaikan'){
                                xd[i].style.fill="#654d4c";
                            } else {
                                xd[i].style.fill="#ffffff";
                            }
                        }
                    }



                    xd[i].addEventListener("click", function(callback){
                        <?php if(!isset($this->data['token']['username'])) { ?>
                            $("#modalLogin").modal();
                        <?php } else { ?>
                            if((gstatus_asrama != 'rusak')){

                                if(gstatus_kamar != 'booking'){

                                    if(gstatus_kamar != 'isi'){

                                        if(gstatus_kamar != 'perbaikan'){

                                            $('#id').val(gid);
                                            $('#lantai').val(glantai);
                                            $('#dgedung').text(jgedung);
                                            $('#dlantai').text(glantai);
                                            $('#dnkamar').text(jnkmar);
                                            $('#status_asrama').val(gstatus_asrama);
                                            $('#idval').val(gidval);
                                            $("#myModal").modal();
                                        }
                                    }

                                }
                            }
                        <?php } ?>
                    });
                    
                }
            }



            xd[i].addEventListener("mouseover", function(callback){
                callback.target.style.opacity="0.5"
            });

            xd[i].addEventListener("mouseleave", function(callback){
                callback.target.style.opacity="1"
            });

        }
    }


    $(document).ready(function() {
        $('#btnNext').on('click', function() {
            let check_elem = $('.agreecbox');
            if(check_elem.prop("checked")){
              $('#nextDiv').show();
              $('#myDIV').hide();
              $("#btnBack").show();
              $("#btnNext").hide()
              $('#btnFinish').show();
          } else {
              $("#agreebox").addClass('text-danger');
              $('#infoAlert').show();
          }
      });
        $('#btnBack').on('click', function() {
          $('#myDIV').show();
          $('#nextDiv').hide();
          $("#btnBack").hide();
          $("#btnNext").show()
          $('#btnFinish').hide();
          $("#agreebox").removeClass('text-danger');
          $('#infoAlert').hide();
      });
    });

</script>



<script src="<?= base_url()?>assets/frontend/js/plugins.js"></script>

<script>
    $('#btn_update').click(function () {

        var content = {};
        content.message = 'selamat';
        content.title = 'success';
        content.icon = 'fas fa-check';

        var notify = $.notify(content, {
            spacing: 10,
            mouse_over: true,
            type: 'success',
            allow_dismiss: true,
            timer: 2000,
            newest_on_top: true,
            showProgressbar: false,
            placement: {
                from: 'top',
                align: 'right'
            },
            template: '<div data-notify="container" class="col-xs-11 col-sm-3 alert alert-success" role="alert">' +
            '<button type="button" aria-hidden="true" class="close" data-notify="dismiss"><i class="icon-x"></i></button>' +
            '<span data-notify="icon"></span> ' +
            '<span data-notify="title">{1}</span> ' +
            '<span data-notify="message">{2}</span>' +
            '<div class="progress" data-notify="progressbar">' +
            '</div>',
            offset: {
                x: 30,
                y: 30
            },
            delay: 1000,
            z_index: 10000,
            animate: {
                enter: 'animated ' + 'fadeInDown',
                exit: 'animated ' + 'fadeOutDown'
            }

        });


    });
</script>